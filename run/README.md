# Guide to run files


## Gene Set Overlaps

`rvc_overlap.sh` calculates the direct overlap betweeng genes identified by rare variants and common variants for each trait.

* Inputs:
    * `<rare_file>` - file listing file names of rare variant gene sets 
    * `<common_file>` - file listing file names of common variant gene sets
    * (Optional) P-value thresholds, gene background size, minimum number of genes per set
* Executes: `gene_overlap.py`
* Outputs: Results of hypergeometric tests for each trait pair of rare and common gene sets, written to OUTDIR. 

## Pre-calculate network heat matrices for each network

Calculation of the heat matrix for a network is independent of the gene sets being analyzed. Therefore, precomputing these matrices can improve efficiency of NetColoc across many gene sets. The script `get_netcoloc_matrices.sh` can be used to perform this step. 

* Inputs: Network name (for file naming), and network uuid of the network from [NDEx](ndexbio.org)
* Executes: `get_heat_matrix.py`
* Outputs: 
    * `<name>_w_prime.npy` - Normalized adjacency matrix of the network
    * `<name>_individual_heats.npy` - Individual heat contributions from the closed form solution to random walk with restart.
    * `<name>_nodes.txt` - List of all network nodes
    * `<name>_degrees.txt` - Degrees of all network nodes


## Network Colocalization

The script `rvc_qnetcoloc.sh` performs the main network colocalization analysis.

* Inputs: 
    * <config>. Configuration file for NetColoc, see `run_configs/example.config`. Specifies: data and output directories, traitlist files &  NetColoc run options.
    * Network information: <uuid> network identifier, <name> network name for file naming and locating the precalculated heat matrix, <netdir> Location of the precalculated heat matrix
    * Gene list suffixes <raresuff>, <commonsuff> for the gene set file names
    * Run parameters: <binsize> bin size for degree-matched randomization, <min_genes> Minimum number of genes per gene set that are present in the network.
* Executes: `do_carva_netcoloc.py`
* Outputs: 
    * Z-scores: One file per gene set listing the z-scores from network propagation, named as `[trait]_z_[raresuff][suffix].tsv`
    * NetColoc results: One file per trait pair named `[q]netcoloc_[rare trait]_[common trait]_[suffix].txt`


## Network shortest paths

`run_shortest_paths.sh` calculates the shortest paths between all network nodes.

* Inputs: uuid identifier of network, prefix for network naming
* Executes: `find_shortest_path.py`
* Outputs: Saves `<prefix>path_lengths.csv` containing all shortest path lengths. 


## Network geneset properties

`annotations.sh` calculates network properties of gene sets. Requires `run_shortest_path.sh` to have been previousy run.

* Inputs: 
    * `<geneset_file>` - file listing file names of rare variant gene sets 
    * `<geneset_file2>` - file listing file names of common variant gene sets
    * `<uuid_list>` - list of network identifiers on NDEx
    * `<name_list>` - names for each network in uuid_list
* Executes: 
    * `get_network_stats.py` - calculate all clustering coefficients for each node
    * `network_annotation.py` - calculate all network annotations
* Outputs:
    * `network_stats_...` - Network statistics for all genesets (except modularities)
    * `network_modularities...` - Modularities for all genesets

## Bulk subnetwork creation

The script `run_subnetwork_creation.sh` generates subnetworks from network colocalization results and saves them to file. 

* Inputs:
    * <traitlist_file> File containing pairs of common and rare variant gene set identifiers in the columns `TraitC` and `TraitR`
    * <z_dir> Directory containing the z_scores generated by network propagation
    * <uuid> Network identifier for subnetwork creation. 
    * (Optional) Z score thresholds for defining the colocalized trait networks. 
* Executes: `create_subnetworks.py`
* Outputs:
    * `...subnetwork_all.tsv` - Edgelist for the colocalized trait network
    * `...subnetwork_all_node_attributes.tsv` - Node information for the colocalized trait network
    * `...subnetwork_inputs.tsv` - Edgelist for the union of all input CVGs and RVGs
    * `...subnetwork_inputs_node_attributes.tsv` - Node information for the union of all input CVGs and RVGs. 

## Download summary statistics

The files `download_sumstats.sh` and `run_download_sumstats.sh` can be used for bulk downloads of summary statistics from the GWAS Catalog.  

* Inputs: File containing download urls (e.g. http://ftp.ebi.ac.uk/pub/databases/gwas/summary_statistics/GCST005001-GCST006000/GCST005842)
* Outputs: Summary statistics files

## Optimization runs

The scripts `sweep_th_rvc_qnetcoloc.sh` and `sweep_bin_rvc_qnetcoloc.sh` were used to perform parameter optimization of the Q-NetColoc method. They execute `do_carva_netcoloc.py` for the same inputs over a range of parameters. See *Network Colocalization* for input/output information.



